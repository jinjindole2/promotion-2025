# PRD (Product Requirements Document)
## 일일 프로모션 서비스

### 1. 제품 개요

#### 1.1 제품명
일일 프로모션 서비스

#### 1.2 제품 목적
사용자가 프로모션에 참여하여 포인트를 적립받을 수 있는 프로모션 관리 시스템

#### 1.3 제품 범위
- 프로모션 등록, 조회, 참여, 참여 이력 조회 기능을 제공하는 백엔드 API 서버
- 다중 서버 환경에서 안정적으로 동작하는 분산 시스템

### 2. 비즈니스 요구사항

#### 2.1 핵심 비즈니스 목표
- 프로모션주가 프로모션를 등록하고 관리할 수 있는 시스템 제공
- 사용자가 프로모션에 참여하여 포인트를 적립받을 수 있는 서비스 제공
- 대량의 동시 접속자와 트래픽을 안정적으로 처리

#### 2.2 성공 지표
- 동시 다중 사용자 프로모션 참여 처리 가능
- 프로모션 참여 가능 횟수 정확한 관리
- 높은 가용성과 안정성 보장

### 3. 기능 요구사항

#### 3.1 프로모션 등록 API
**목적**: 프로모션주가 새로운 프로모션를 시스템에 등록

**필수 입력 항목**:
- 프로모션명 (중복 불가)
- 프로모션 참여시 적립 액수
- 프로모션 참여 가능 횟수
- 프로모션 문구
- 프로모션 이미지 URL
- 프로모션 노출 기간 (시작일, 종료일)

**선택 입력 항목**:
- 프로모션 참가 자격
  - 특정 프로모션 ID를 참가한 이력이 있는 사용자
  - N번 이상 참가한 사용자
  - 처음 참가하는 사용자

**출력**:
- 유니크한 프로모션 ID 생성 및 반환
- 등록 성공/실패 상태

#### 3.2 프로모션 조회 API
**목적**: 사용자에게 노출될 프로모션 목록 조회

**필수 출력 항목**:
- 프로모션 ID
- 프로모션명
- 프로모션 문구
- 프로모션 이미지 URL
- 프로모션 참여시 적립 액수

**조회 조건**:
- 프로모션 참여 가능 횟수가 남아있는 프로모션만 노출
- 프로모션 노출 기간 내의 프로모션만 노출
- 사용자 참가 자격을 만족하는 프로모션만 노출 (선택사항)

**조회 제한**:
- 한 번에 최대 10개 프로모션 조회
- 프로모션 참여시 적립 액수 높은 순으로 정렬

#### 3.3 프로모션 참여 API
**목적**: 사용자의 프로모션 참여 처리 및 포인트 적립

**필수 입력 항목**:
- 사용자 ID
- 프로모션 ID

**처리 로직**:
- 참가 자격 검증 (선택사항)
- 프로모션 참여 가능 횟수 확인 및 차감
- 참여 이력 저장
- 포인트 적립 (적립 서버 API 호출)

**예외 처리**:
- 프로모션 참여 가능 횟수가 0인 경우 참여 불가 에러
- 미등록 프로모션 ID인 경우 미등록 프로모션 에러
- 동시 참여 상황에서의 정확한 횟수 관리

#### 3.4 프로모션 참여 이력 조회 API
**목적**: 사용자의 프로모션 참여 이력 조회

**필수 입력 항목**:
- 사용자 ID
- 조회 기간

**필수 출력 항목**:
- 프로모션 참여 시각
- 사용자 ID
- 프로모션 ID
- 프로모션명
- 적립 액수

**조회 조건**:
- 프로모션 참여 시각 오래된 순으로 정렬
- 한 번에 최대 50개 이력 조회
- 페이지네이션 적용

### 4. 기술 요구사항

#### 4.1 성능 요구사항
- 다수의 서버에서 다수의 인스턴스로 동작
- 대량의 동시 접속자 처리 가능
- 프로모션 참여 가능 횟수의 정확한 관리 (동시성 제어)

#### 4.2 기술 스택

**백엔드 프레임워크**
- Spring Boot 3.3.2
- Spring WebFlux (Reactive Web)
- Kotlin 1.9.24
- JDK 17

**데이터베이스**
- MySQL 8.0 (주 데이터베이스)
- MongoDB 6.0 (프로모션 데이터 저장)
- Redis (캐시 및 분산락)

**비동기 처리**
- Kotlin Coroutines
- Spring Data R2DBC (MySQL 비동기 접근)
- Spring Data MongoDB Reactive (MongoDB 비동기 접근)
- Spring Data Redis Reactive (Redis 비동기 접근)

**메시징**
- Apache Kafka (비동기 메시징)
- Spring Kafka
- Reactor Kafka

**테스트**
- JUnit 5
- Kotest
- MockK
- Testcontainers (통합 테스트)
- Spring Boot Test

**기타 라이브러리**
- MapStruct (객체 매핑)
- Jackson (JSON 처리)
- SpringDoc OpenAPI (API 문서화)
- Spring Boot Validation (유효성 검증)

**개발 도구**
- Gradle Kotlin DSL
- Spring Boot DevTools

**인프라 (Docker Compose)**
- MySQL 8.0
- Redis
- Apache Kafka + Zookeeper
- MongoDB 6.0

#### 4.3 아키텍처 설계 (현재 구현)
- **비동기 논블록킹 API**: Kotlin Coroutine, R2DBC 활용
- **분산락 및 캐싱**: Redis를 활용한 프로모션 참여 처리
- **비동기 메시징**: Kafka를 통한 포인트 적립 요청
- **데이터 동기화**: 배치 스케줄러를 통한 Redis-DB 동기화

### 5. 품질 요구사항

#### 5.1 테스트 요구사항
- 각 기능 및 제약사항에 대한 단위 테스트 필수
- 동시성 제어 테스트
- 에러 상황에 대한 테스트

#### 5.2 문서화 요구사항
- 설계 내용과 설계 이유 문서화
- 핵심 문제 해결 전략 문서화
- API 명세서 작성

### 6. 제약사항

#### 6.1 비즈니스 제약사항
- 프로모션명 중복 불가
- 프로모션 참여 가능 횟수 정확한 관리 필수
- 적립 서버 응답은 무시 (Interface 또는 Mock 사용)

#### 6.2 기술적 제약사항
- 하나의 프로모션에 여러 사용자 동시 참여 가능
- 분산 환경에서의 데이터 일관성 보장 필요